# Task 1: Users and groups

# Используйте команды: groupadd, useradd, passwd, chage и другие.
# Создайте группу sales с GID 4000 и пользователей bob, alice, eve c основной группой sales.
groupadd -g 4000 sales
useradd -g sales alice
useradd -g sales bob
useradd -g sales eve
# после выполнения этих комманд заметил, что они пусть и сделают группу sales основной для пользователей, но не будет отображать наличие пользователей в /etc/group. На всякий случай пропишу их отдельно:
usermod -aG sales alice
usermod -aG sales bob
usermod -aG sales eve

# Измените пользователям пароли.
passwd alice
passwd bob
passwd eve

# Все новые аккаунты должны обязательно менять свои пароли каждый 30 дней.
# данную настройку можно провести в файле /etc/login.defs, изменив pass_max_days с 99999 на 30. Настройки в этом фале будут действовать только для новых пользователей, а не для уже существующих.

# Новые аккаунты группы sales должны истечь по окончанию 90 дней срока, а bob должен изменять его пароль каждые 15 дней.
### не нашел решения для настройки данной опции для группы пользователей одной командой типа chage. При небольшом количестве пользователей проще поменять эту настройку вручную. Соответствующая команда есть даже в man chage:
chage -E $(date -d +90days +%Y-%m-%d) alice
chage -E $(date -d +90days +%Y-%m-%d) bob
chage -E $(date -d +90days +%Y-%m-%d) eve
chage -M 15 bob

# Дополнительно:
# Заставьте пользователей сменить пароль после первого логина.
chage -d 0 alice
# если вдруг придется часто проводить одинкаковые операции с группой sales или какой-то другой, то лучше написать для этих задач скрипт, который будет спрашивать имя пользователя и нужную группу, а потом с помощью переменной прогонять по всем этим комнадам.

# Предварительный шаг:
# Исследуйте файл /etc/login.defs.
# При работе с инструментами как useradd предполагаются некоторые значения по умолчанию. Эти значения по умолчанию установлены в двух файлах конфигурации: /etc/login.defs и /etc/default/useradd.
# Список некоторых наиболее важных свойств, которые можно установить в /etc/login.defs:
# MOTD_FILE: Определяет файл, который используется как файл «сообщения дня». В этот файл можно включить сообщения, которые будут отображаться после успешного входа пользователя на сервер.
# ENV_PATH: определяет переменную $PATH, список каталогов, в которых следует искать исполняемые файлы после входа в систему.
# PASS_MAX_DAYS, PASS_MIN_DAYS и PASS_WARN_AGE: определение свойств срока действия пароля по умолчанию при создании новых пользователей.
# UID_MIN: первый UID, который будет использоваться при создании новых пользователей.
# CREATE_HOME: указывает, следует ли создавать домашний каталог для новых пользователей.
# USERGROUPS_ENAB: установите yes, чтобы создать личную группу для всех новых пользователей. Это означает, что у нового пользователя есть группа с тем же именем, что и пользователь, в качестве группы по умолчанию. Если установлено значение no, все пользователи становятся членами группы users.

# Исследуйте, как работает команда date и как её использовать совместно с chage.

###############################################################################

# Task 2: Controlling access to files with Linux file system permissions

# Используйте команды: su, mkdir, chown, chmod и другие.
# Создайте трёх пользователей glen, antony, lesly.
useradd glen
useradd antony
useradd lesly
# с помощью passwd так же задаю им пароли
passwd glen
passwd antony
passwd lelsy
# У вас должна быть директория /home/students, где эти три пользователя могут работать совместно с файлами.
mkdir /home/students
# Должен быть возможен только пользовательский и групповой доступ, создание и удаление файлов в /home/students.
groupadd students
usermod -aG students glen
usermod -aG students antony
usermod -aG students lesly
chmod 770 /home/students # изначально пробовал задавать 660, но пользователи не могут войти в директорию без прав на исполнение
chgrp students /home/students # или можно использовать команду chown :students /home/students

# Файлы, созданные в этой директории, должны автоматически присваиваться группе студентов students.
chmod g+s /home/students # данная команда задаст стики-бит для папки students, и тогда все папки и файлы в ней будут наследовать группу данной папки

# Предварительный шаг:
# Исследуйте, для чего нужны файлы .bashrc и .profile.
# /etc/profile: используется для настроек по умолчанию для всех пользователей при запуске оболочки входа
# /etc/bashrc: используется для определения значений по умолчанию для всех пользователей при запуске подоболочки
# ~/.profile: специальные настройки для одного пользователя, применяемые при запуске оболочки входа
# ~/.bashrc: специальные настройки для одного пользователя, применяемые при запуске подоболочки



# Task3: ACL

# Детективное агентство Бейкер Стрит создает коллекцию совместного доступа для хранения файлов дел, в которых члены группы bakerstreet будут иметь права на чтение и запись.


# Ведущий детектив, Шерлок Холмс, решил, что члены группы scotlandyard также должны иметь возможность читать и писать в общую директорию. Тем не менее, Холмс считает, что инспектор Джонс является достаточно растерянным, и поэтому он должен иметь доступ только для чтения.

# Миссис Хадсон только начала осваивать Linux и смогла создать общую директорию и скопировать туда несколько файлов. Но сейчас время чаепития, и она попросила вас закончить работу.

# Ваша задача - завершить настройку директории общего доступа.
# Директория и всё её содержимое должно принадлежать группе bakerstreet, при этом файлы должны обновляться для чтения и записи для владельца и группы (bakerstreet). У других пользователей не должно быть никаких разрешений.

# Вам также необходимо предоставить доступы на чтение и запись для группы scotlandyard, за исключением Jones, который может только читать документы.
# Убедитесь, что ваша настройка применима к существующим и будущим файлам. После установки всех разрешений в директории проверьте от каждого пользователя все его возможные доступы.

# Используйте команды: touch, mkdir, chgrp, chmod, getfacl, setfacl и другие.
# Создайте общую директорию /share/cases.
# Создайте группу bakerstreet с пользователями holmes, watson.
# Создайте группу scotlandyard с пользователями lestrade, gregson, jones.
# Задайте всем пользователям безопасные пароли.

# Предварительный шаг:
# От суперпользователя создайте папку /share/cases и создайте внутри 2 файла murders.txt и moriarty.txt.

mkdir -p /share/cases
touch /share/cases/murders.txt
touch /share/cases/moriarty.txt


groupadd bakerstreet
useradd -g bakerstreet holmes
useradd -g bakerstreet watson
passwd holmes
passwd watson

groupadd scotlandyard
useradd -g scotlandyard lestrade
useradd -g scotlandyard gregson
useradd -g scotlandyard jones

passwd lestrade
passwd gregson
passwd jones

chown -R :bakerstreet /share/cases # Директория и всё её содержимое будет принадлежать группе bakerstreet
chmod -R 770 /share/cases # опция -R рекурсивно раздаст джанные настройки всем вложенным в директорию файлам
setfacl -m group:scotlandyard:rwx /share/cases #члены группы scotlandyard также должны иметь возможность читать и писать в общую директорию, поэтому им тоже полные права
setfacl -m user:jones:rx /share/cases # инспектор Джонс является достаточно растерянным, и поэтому он должен иметь доступ только для чтения

chmod g+s /share/cases # всё содержимое директории будет принадлежать группе bakerstreet
